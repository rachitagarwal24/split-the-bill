<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Split the Bill</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #eef2ff, #f8fafc);
      padding: 16px;
      max-width: 900px;
      margin: auto;
      color: #111827;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
      font-size: clamp(1.6rem, 4vw, 2rem);
    }
    .card {
      background: #ffffff;
      padding: 16px;
      margin-bottom: 16px;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.08);
    }
    h3 {
      margin-top: 0;
      margin-bottom: 12px;
      font-size: 1.1rem;
    }
    input, select {
      width: 100%;
      padding: 12px 14px;
      margin-top: 10px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      font-size: 16px;
    }
    button {
      margin-top: 12px;
      padding: 12px 16px;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      background: linear-gradient(135deg, #6366f1, #4f46e5);
      color: #fff;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
      font-size: 14px;
      overflow-x: auto;
      display: block;
    }
    th, td {
      padding: 10px;
      border-bottom: 1px solid #e5e7eb;
      text-align: left;
      white-space: nowrap;
    }
    th { background: #eef2ff; }

    /* Responsive checkbox grid */
    #splitBetween {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }
    #splitBetween label {
      background: #f1f5f9;
      padding: 10px 12px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 15px;
      cursor: pointer;
    }
    #splitBetween input[type="checkbox"] {
      width: 18px;
      height: 18px;
    }

    /* Mobile tweaks (iPhone friendly) */
    @media (max-width: 480px) {
      body { padding: 12px; }
      button { width: 100%; }
      th, td { font-size: 13px; }
    }
  </style>
</head>
<body>

  <h1>ðŸ’¸ Split the Bill</h1>

  <div class="card">
    <h3>Add Friends</h3>
    <input type="text" id="friendName" placeholder="Friend name" onkeydown="handleFriendEnter(event)" />
    <button onclick="addFriend()">Add Friend</button>
    <ul id="friendsList"></ul>
  </div>

  <div class="card">
    <h3>Bill Details</h3>
    <input type="number" id="amount" placeholder="Total amount" />
    <input type="text" id="billNote" placeholder="Bill note (e.g. Dinner, Movie, Taxi)" />
    <select id="paidBy"></select>
    <p>Split between:</p>
    <div id="splitBetween"></div>
    <button onclick="splitBill()">Split Bill</button>
  </div>

  <div class="card">
    <h3>Bills Summary</h3>
    <table border="1" width="100%" cellpadding="6" style="border-collapse:collapse">
      <thead>
        <tr>
          <th>Bill</th>
          <th>Reason</th>
          <th>Payer</th>
          <th>Person</th>
          <th>Amount (â‚¹)</th><th>Actions</th>
        </tr>
      </thead>
      <tbody id="billTable"></tbody>
    </table>
  </div>

  <div class="card">
    <h3>Total Payable by Each Member</h3>
    <button onclick="toggleTotals()" style="margin-bottom:10px">Show / Hide Totals Clearly</button>
    <table id="totalsSection" border="1" width="100%" cellpadding="6" style="border-collapse:collapse; display:none">
      <thead>
        <tr>
          <th>Member</th>
          <th>Total Amount to Pay (â‚¹)</th>
        </tr>
      </thead>
      <tbody id="totalTable"></tbody>
    </table>
    <button id="pdfBtn" onclick="downloadPDF()" style="display:none;margin-top:10px">Download PDF</button>
    <button id="xlsxBtn" onclick="downloadXLSX()" style="display:none;margin-top:10px">Export XLSX</button>
  </div>

  <script>
    let bills = [];
    let billCounter = 1;
    const friends = [];

    function addFriend() {
      
      const name = document.getElementById('friendName').value.trim();
      if (!name) return;

      friends.push(name);
      document.getElementById('friendName').value = '';
      renderFriends();
    }

    function handleFriendEnter(event) {
      if (event.key === 'Enter') {
        addFriend();
      }
    }

    function renderFriends() {
      const list = document.getElementById('friendsList');
      const paidBy = document.getElementById('paidBy');
      const splitBetween = document.getElementById('splitBetween');

      list.innerHTML = '';
      paidBy.innerHTML = '';
      splitBetween.innerHTML = '';

      friends.forEach(friend => {
        const li = document.createElement('li');
        li.textContent = friend;
        list.appendChild(li);

        const option = document.createElement('option');
        option.value = friend;
        option.textContent = friend;
        paidBy.appendChild(option);

        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.value = friend;
        checkbox.checked = true;

        const label = document.createElement('label');
        label.style.display = 'block';
        label.appendChild(checkbox);
        label.append(' ' + friend);
        splitBetween.appendChild(label);
      });
    }

    function splitBill() {
      const amountInput = document.getElementById('amount');
      const noteInput = document.getElementById('billNote');
      const amount = parseFloat(amountInput.value);
      const paidBy = document.getElementById('paidBy').value;
      const note = noteInput.value.trim();
      const checked = [...document.querySelectorAll('#splitBetween input:checked')]
        .map(cb => cb.value);

      if (!amount || checked.length === 0) return;

      const share = parseFloat((amount / checked.length).toFixed(2));
      const billIndex = billCounter;

      checked.forEach(friend => {
        if (friend !== paidBy) {
          bills.push({
            bill: `Bill ${billIndex}`,
            reason: note || 'â€”',
            payer: paidBy,
            person: friend,
            amount: share
          });
        }
      });

      renderTable();
      renderTotals();

      document.getElementById('pdfBtn').style.display = 'block';
      document.getElementById('xlsxBtn').style.display = 'block';

      // âœ… Clear bill inputs for next entry
      amountInput.value = '';
      noteInput.value = '';
      document.querySelectorAll('#splitBetween input').forEach(cb => cb.checked = true);

      billCounter++;

      alert('Bill split successfully! You can now add another bill.');
    }
  
    function downloadPDF() {
      const doc = new jspdf.jsPDF();

      // Calculate totals
      const totals = calculateTotals();
      const totalRows = Object.keys(totals).map(m => [m, `â‚¹${totals[m].toFixed(2)}`]);
      const overallTotal = Object.values(totals).reduce((a,b)=>a+b,0);

      // 1ï¸âƒ£ Totals first
      doc.text('Total Payable Summary', 14, 15);
      doc.autoTable({
        startY: 20,
        head: [['Member', 'Total Amount (â‚¹)']],
        body: totalRows,
        foot: [['Overall Total', `â‚¹${overallTotal.toFixed(2)}`]]
      });

      // 2ï¸âƒ£ Bills breakdown on next page
      doc.addPage();
      doc.text('Bills Breakdown', 14, 15);
      const billRows = bills.map(b => [b.bill, b.reason, b.payer, b.person, `â‚¹${b.amount.toFixed(2)}`]);
      const billTotal = bills.reduce((s,b)=>s+b.amount,0);

      doc.autoTable({
        startY: 20,
        head: [['Bill', 'Reason', 'Payer', 'Person', 'Amount (â‚¹)']],
        body: billRows,
        foot: [['', '', '', 'Grand Total', `â‚¹${billTotal.toFixed(2)}`]]
      });

      doc.save('split-bill-summary.pdf');
    }

    function downloadXLSX() {
      const billData = [['Bill', 'Reason', 'Payer', 'Person', 'Amount']];
      bills.forEach(b => billData.push([b.bill, b.reason, b.payer, b.person, b.amount]));

      const billTotal = bills.reduce((s,b)=>s+b.amount,0);
      billData.push(['', '', '', 'Grand Total', billTotal]);

      const totals = calculateTotals();
      const totalData = [['Member', 'Total Amount']];
      Object.keys(totals).forEach(m => totalData.push([m, totals[m]]));

      const overall = Object.values(totals).reduce((a,b)=>a+b,0);
      totalData.push(['Overall Total', overall]);

      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(billData), 'Bills');
      XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(totalData), 'Totals');
      XLSX.writeFile(wb, 'split-bill-summary.xlsx');
    }
  function renderTable() {
      const tbody = document.getElementById('billTable');
      tbody.innerHTML = '';
      bills.forEach((b, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${b.bill}</td>
          <td>${b.reason}</td>
          <td>${b.payer}</td>
          <td>${b.person}</td>
          <td>${b.amount}</td>
          <td>
            <button style="background:#059669;margin-bottom:4px" onclick="editBill(${index})">Edit</button>
            <button style="background:#dc2626" onclick="deleteBill(${index})">Delete</button>
          </td>`;
        tbody.appendChild(tr);
      });
    }
  function calculateTotals() {
      const totals = {};
      bills.forEach(b => {
        totals[b.person] = (totals[b.person] || 0) + b.amount;
      });
      return totals;
    }

    function renderTotals() {
      const tbody = document.getElementById('totalTable');
      tbody.innerHTML = '';
      const totals = calculateTotals();
      Object.keys(totals).forEach(member => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${member}</td><td>â‚¹${totals[member].toFixed(2)}</td>`;
        tbody.appendChild(tr);
      });
    }
  function toggleTotals() {
      const section = document.getElementById('totalsSection');
      section.style.display = section.style.display === 'none' ? 'table' : 'none';
    }
  function deleteBill(index) {
      if (!confirm('Are you sure you want to delete this bill entry?')) return;
      bills.splice(index, 1);
      renderTable();
      renderTotals();
    }

    function editBill(index) {
      const b = bills[index];
      const newReason = prompt('Edit bill reason:', b.reason);
      const newAmount = prompt('Edit amount:', b.amount);

      if (newReason !== null) b.reason = newReason || 'â€”';
      if (newAmount !== null && !isNaN(newAmount)) b.amount = parseFloat(newAmount);

      renderTable();
      renderTotals();
    }
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

</body>
</html>
